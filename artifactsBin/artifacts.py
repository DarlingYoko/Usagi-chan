'''
ĞÑ€Ñ‚ĞµÑ„Ğ°ĞºÑ‚Ñ‹

1) Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ½Ğ¾Ğ²Ñ‹Ñ… Ğ°Ñ€Ñ‚Ğ¾Ğ² Ñ‡ĞµÑ€ĞµĞ· ÑĞºÑ€Ğ¸Ğ½/Ğ²Ñ€ÑƒÑ‡Ğ½ÑƒÑ
2) ĞŸÑ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ ÑĞ²Ğ¾Ğ¸Ñ… Ğ°Ñ€Ñ‚Ğ¾Ğ² Ğ¸Ğ»Ğ¸ Ñ‡ÑƒĞ¶Ğ¸Ñ… Ñ‡ĞµÑ€ĞµĞ· select'Ñ‹
3) Ğ¡Ğ±Ğ¾Ñ€ĞºĞ° ÑĞ²Ğ¾ĞµĞ³Ğ¾ Ğ±Ğ¸Ğ»Ğ´Ğ° Ğ½Ğ° Ğ¿ĞµÑ€ÑĞ¾Ğ½Ğ°Ğ¶Ğ° (ĞºĞ°Ğº Ğ²Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚ Ñ‡ĞµÑ€ĞµĞ· ÑĞµĞ»ĞµĞºÑ‚Ñ‹ Ğ¸ ĞºĞ½Ğ¾Ğ¿ĞºĞ¸)
4) Ñ€Ğ¾Ğ»Ğ¸Ñ‚ÑŒ Ğ°Ñ€Ñ‚Ñ‹


ĞšĞ°Ğº Ğ²Ñ‹Ğ³Ğ»ÑĞ´Ğ¸Ñ‚ Ğ±Ğ´:
Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° Ğ²ÑĞµÑ… Ğ°Ñ€Ñ‚Ğ¾Ğ² (ID, Ñ‚Ğ¸Ğ¿Ñ‹ Ğ²ÑĞµÑ… ÑÑ‚Ğ°Ñ‚Ğ¾Ğ², Ğ¼ĞµĞ¹Ğ½ ÑÑ‚Ğ°Ñ‚, ÑĞ°Ğ± ÑÑ‚Ğ°Ñ‚1, ÑĞ°Ğ± ÑÑ‚Ğ°Ñ‚2, ÑĞ°Ğ± ÑÑ‚Ğ°Ñ‚3, ÑĞ°Ğ± ÑÑ‚Ğ°Ñ‚4)
Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° ÑĞ·ĞµÑ€Ğ¾Ğ² Ğ¸ id Ğ¸Ñ… Ğ°Ñ€Ñ‚Ğ¾Ğ²



Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ½Ğ¾Ğ²Ñ‹Ñ… Ğ°Ñ€Ñ‚Ğ¾Ğ²:

1) Ğ²Ñ‹Ğ·Ğ¾Ğ² ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ + ÑĞºÑ€Ğ¸Ğ½/Ğ¿ÑƒÑÑ‚Ğ¾ !Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ "Ñ‡Ğ°ÑÑ‚ÑŒ" "ÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒ ĞµÑĞ»Ğ¸ Ğ½Ğµ 20"
2) Ğ³ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµÑ‚ÑÑ ÑÑ‚Ğ°Ñ€Ñ‚Ğ¾Ğ²Ñ‹Ğ¹ Ğ±Ğ»Ğ°Ğ½Ğº Ğ°Ñ€Ñ‚Ğ° Ğ»Ğ¸Ğ±Ğ¾ Ğ½Ğ° Ğ¾ÑĞ½Ğ¾Ğ²Ğµ ÑĞºÑ€Ğ¸Ğ½Ğ°, Ğ»Ğ¸Ğ±Ğ¾ Ğ¿ÑƒÑÑ‚Ğ¾Ğ¹ Ğ¿Ğ¾Ğ»Ğ½Ğ¾ÑÑ‚ÑŒÑ
3) Ñ‡ĞµÑ€ĞµĞ· ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ ÑĞ·ĞµÑ€ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ÑĞµÑ‚/Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµÑ‚ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹ Ğ°Ñ€Ñ‚Ğ°
4) ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ğ°Ñ€Ñ‚Ğ° Ğ² Ğ±Ğ´
5) Ğ¾Ğ±Ğ½Ğ¾Ğ²ĞµĞ»Ğ½ĞµĞ¸ Ğ·Ğ°ĞºÑ€ĞµĞ¿Ğ° Ñ ID-ÑˆĞ½Ğ¸ĞºĞ°Ğ¼Ğ¸ ÑĞ·ĞµÑ€Ğ¾Ğ²
+

1. ĞŸÑƒÑÑ‚Ğ¾Ğ¹ Ğ±Ğ»Ğ°Ğ½Ğº Ñ Ğ²Ñ‹Ğ±Ğ¾Ñ€Ğ¾Ğ¼ ÑĞµÑ‚Ğ°
2. Ğ•ÑĞ»Ğ¸ Ñ†Ğ²ĞµÑ‚Ğ¾Ğº Ğ¸Ğ»Ğ¸ Ğ¿ĞµÑ€Ğ¾ Ñ‚Ğ¾ Ğ¼ĞµĞ¹Ğ½ ÑÑ‚Ğ°Ñ‚ Ğ¿Ğ¸ÑˆĞµÑ‚ÑÑ ÑĞ°Ğ¼, ĞµÑĞ»Ğ¸ Ğ½ĞµÑ‚, Ñ‚Ğ¾ Ğ²Ñ‹Ğ±Ğ¾Ñ€ ÑĞµĞ»ĞµĞºÑ‚Ğ¾Ğ¼ Ğ¼ĞµĞ¹Ğ½ ÑÑ‚Ğ°Ñ‚Ğ°
3. Ğ»ÑƒĞ¿ Ğ½Ğ° Ğ½Ğ°Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ğ¼ĞµĞ¹Ğ½ ÑÑ‚Ğ°Ñ‚Ğ°
4. Ğ’Ñ‹Ğ±Ğ¾Ñ€ ÑĞ°Ğ± ÑÑ‚Ğ°Ñ‚Ğ°
5. Ğ»ÑƒĞ¿ Ğ·Ğ°Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ ÑĞ°Ğ± ÑÑ‚Ğ°Ñ‚Ğ°
6. Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ñ‚ÑŒ ĞµÑ‰Ñ‘ 3 Ñ€Ğ°Ğ·Ğ°


ĞŸÑ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ Ğ°Ñ€Ñ‚Ğ¾Ğ²:

1) Ğ²Ñ‹Ğ±Ğ¾Ñ€ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ğ¿Ğ¾ ID
2) Ñ‡ĞµÑ€ĞµĞ· ÑĞµĞ»ĞµĞºÑ‚Ñ‹ Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ²Ñ‹Ğ±Ñ€Ğ°Ñ‚ÑŒ Ñ‚Ğ¸Ğ¿ Ğ¸ ÑĞµÑ‚
3) ĞºĞ½Ğ¾Ğ¿ĞºĞ¸ Ğ½ĞµĞºÑÑ‚ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñ‹
4) Ğ½Ğ° ĞºĞ°Ğ¶Ğ´Ğ¾Ğ¹ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğµ Ğ¿Ğ¾ 4 Ğ°Ñ€Ñ‚Ğ° ÑĞ¾ Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ğ¹ Ñ…Ğ°Ñ€Ğ°ĞºÑ‚ĞµÑ€Ğ¸ÑÑ‚Ğ¸ĞºĞ¾Ğ¹ Ğ¸ Id'ÑˆĞ½Ğ¸ĞºĞ¾Ğ¼

Ğ¸Ğ»Ğ¸ Ğ¶Ğµ Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»Ñ‘Ğ½Ğ½Ğ¾Ğ³Ğ¾ Ğ°Ñ€Ñ‚Ğ° Ğ¿Ğ¾ ĞµĞ³Ğ¾ ID Ğ² 16-Ñ‚Ğ¸ Ñ€Ğ¸Ñ‡Ğ½Ğ¾Ğ¼ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğµ


Ğ¡Ğ±Ğ¾Ñ€ĞºĞ° Ğ±Ğ¸Ğ»Ğ´Ğ¾Ğ² Ğ¿Ğ¾Ğ¿Ğ¾Ğ·Ğ¶Ğµ, Ğ½Ğ¾ Ñ‡Ñ‚Ğ¾ Ñ‚Ğ¾ Ğ¿Ğ¾Ñ…Ğ¾Ğ¶ĞµĞµ Ğ½Ğ° Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ñ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸ĞµĞ¼ Ğ² Ğ±Ğ»Ğ°Ğ½Ğº Ğ¿ĞµÑ€ÑĞ°


ĞŸĞ»Ğ°Ğ½Ñ‹ Ğ½Ğ° Ğ·Ğ°Ğ²Ñ‚Ñ€Ğ°:
    1. Ğ¡Ğ´ĞµĞ»Ğ°Ñ‚ÑŒ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ°Ñ€Ñ‚Ğ° Ñƒ ÑĞ·ĞµÑ€Ğ° +
    2. ĞĞ°Ñ‡Ğ°Ñ‚ÑŒ Ğ´ĞµĞ»Ğ°Ñ‚ÑŒ Ğ¿Ğ¾ĞºĞ°Ğ·
    3. ĞŸĞ»ĞµĞµÑ€?

'''

import os, sys
import asyncio
import discord
from discord_components import Button, Select, ButtonStyle, InteractionType, SelectOption
from src.functions import createEmbed, getCurrentTime, printError
from artifactsBin.extraFunc import *


class Artifacts:

    def __init__(self, client, config, db):
        self.client = client
        self.config = config
        self.db = db


    async def addNewArtifact(self, message):

        data = message.content.split('!Ğ°Ñ€Ñ‚')


        try:
            if data[1]:
                lvl = int(data[1].split()[1].rstrip())
                part = data[1].split()[0].rstrip()
                print(lvl, part)
                await self.generateBlank(message = message, lvl = lvl, part = part)

            else:
                pass
        except Exception as e:
            printError()


    async def showUserArtifacts(self, message):
        try:
            channel = message.channel
            splitter = message.content.split()
            id = message.author.id



            if len(splitter) > 1:
                try:
                    id = int(splitter[1])
                except ValueError:
                    member = discord.utils.find(lambda m: m.display_name.lower().startswith(splitter[1].lower()), message.guild.members)

                    if member:
                        id = member.id
                    else:
                        await channel.send(f'<@{message.author.id}>, ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ½Ğ°Ğ¹Ñ‚Ğ¸ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ, Ğ±Ğ°Ğ°Ğ°ĞºĞ°!')
                        return
            artifactsIDs = self.db.getValue(tableName = 'users_arts', argument = 'artifacts', selector = 'user_id', value = id)
            if not artifactsIDs:
                answer = f'<@{message.author.id}>, Ğ£ Ñ‚ĞµĞ±Ñ Ğ½ĞµÑ‚ Ğ°Ñ€Ñ‚ĞµÑ„Ğ°ĞºÑ‚Ğ¾Ğ², Ğ±Ğ°Ğ°Ğ°ĞºĞ°!'
                if len(splitter) > 1:
                    answer = f'<@{message.author.id}>, Ğ£ ÑÑ‚Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ğ½ĞµÑ‚ Ğ°Ñ€Ñ‚ĞµÑ„Ğ°ĞºÑ‚Ğ¾Ğ², Ğ±Ğ°Ğ°Ğ°ĞºĞ°!'
                await channel.send(answer)
                return
            artifactsIDs = eval(artifactsIDs)
            username = await self.client.fetch_user(id)
            authorName = 'ĞšĞ¾Ğ»Ğ»ĞµĞºÑ†Ğ¸Ñ {}'.format(username.display_name)
            authorIconURL = 'https://cdn.discordapp.com/attachments/813825744789569537/877565170258411550/user_account_person_avatar_icon_131248.png'


            fields = []

            for art in artifactsIDs:
                res = self.db.command(f'SELECT * from artifacts where id = {int(art)};')[0]
                name = f'{res[2]} {res[3]} lvl\n{res[1]}\n{res[4]}'

                value = '**â”â”â”â”â”â”â”“**\n'
                for i in range(0, 8, 2):
                    space = 'Â ' * (14 - len(res[6 + i]) - len(res[7  + i]))
                    value += f'`{res[6 + i]}{space}{res[7 + i]}`\n'
                value += '**â”—â”â”â”â”â”â”›**\n'

                zero = '0' * (5 - len(str(res[0])))
                value += f'Â Â Â ID {zero}{res[0]}'
                fields.append({'name': name, 'value': value, 'inline': True})

            pages = [fields[i:i+6] for i in range(0, len(fields), 6)]
            page = 0

            components = getQueryBtns(self, f'Page {page + 1}/{len(pages)}')
            embed = createEmbed(authorName = authorName, authorIconURL = authorIconURL, fields = pages[page])
            question = await channel.send(embed = embed, components = components)

            while True:
                def check(res):
                    return res.channel == channel and res.author == message.author and res.message.id == question.id

                try:
                    res = await self.client.wait_for("button_click", check = check, timeout = 60.0)

                except:

                    await question.edit(components = [])
                    await question.delete(delay = 10)
                    await message.delete(delay = 10)
                    return
                    return

                else:
                    if res.component.id == 'start':
                        page = 0

                    elif res.component.id == 'previuos':
                        if page != 0:
                            page -= 1

                    elif res.component.id == 'next':
                        if page != len(pages) - 1:
                            page += 1

                    elif res.component.id == 'end':
                        page = len(pages) - 1

                    components = getQueryBtns(self, f'Page {page + 1}/{len(pages)}')
                    embed = createEmbed(authorName = authorName, authorIconURL = authorIconURL, fields = pages[page])

                    await res.respond(type=7, embed = embed, components = components)

        except:
            printError()

    def showArtifactByID(self):
        pass

    def updatePinMessage(self):
        pass

    async def generateBlank(self, message, set = None, lvl = None, part = None, main = None, sub1 = None, sub2 = None, sub3 = None, sub4 = None):
        part = part.lower()
        try:
            channel = await self.client.fetch_channel(self.config['data'].getint('mpChannel'))
            if part in ['ĞºĞ¾Ñ€Ğ¾Ğ½Ğ°', 'ÑˆĞ»ÑĞ¿Ñ', 'ÑˆĞ»ÑĞ¿Ğ°']:
                part = 'ÑˆĞ°Ğ¿ĞºĞ°'

            parts = {'Ñ†Ğ²ĞµÑ‚Ğ¾Ğº': ['https://cdn.discordapp.com/attachments/813825744789569537/877563359808069692/flower.png', 'ğ“•ğ“µğ“¸ğ”€ğ“®ğ“»'],
                    'Ğ¿ĞµÑ€Ğ¾': ['https://cdn.discordapp.com/attachments/813825744789569537/877563356431659008/feather.png', 'ğ“Ÿğ“µğ“¾ğ“¶ğ“®'],
                    'Ñ‡Ğ°ÑÑ‹': ['https://cdn.discordapp.com/attachments/813825744789569537/877563350983245854/clock.png', 'ğ“¢ğ“ªğ“·ğ“­ğ“¼'],
                    'ĞºÑƒĞ±Ğ¾Ğº': ['https://cdn.discordapp.com/attachments/813825744789569537/877563363163533332/goblet.png', 'ğ“–ğ“¸ğ“«ğ“µğ“®ğ“½'],
                    'ÑˆĞ°Ğ¿ĞºĞ°': ['https://cdn.discordapp.com/attachments/813825744789569537/877563236147404840/circlet.png', 'ğ“’ğ“²ğ“»ğ“¬ğ“µğ“®ğ“½'],}

            if lvl not in [16, 20] or part not in parts.keys():
                await channel.send('<@{}> ĞĞµĞ²ĞµÑ€Ğ½Ñ‹Ğ¹ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ, Ğ±Ğ°ĞºĞ°!'.format(message.author.id))
                return

            sets = getSets()

            allStats, elements, mainStats = getStats()

            subStat = ['ATK', 'ATK%', 'CRIT DMG', 'CRIT RATE', 'HP', 'HP%', 'DEF', 'DEF%', 'EM', 'ER',]

            mainStat = mainStats[part]




            authorName = 'Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ½Ğ¾Ğ²Ğ¾Ğ³Ğ¾ Ğ°Ñ€Ñ‚ĞµÑ„Ğ°ĞºÑ‚Ğ°'
            authorIconURL = 'https://cdn.discordapp.com/attachments/813825744789569537/877650197122011166/icon-document_87920.png'
            thumbnail = parts[part][0]

            title = 'Ğ¡ĞµÑ‚ Ğ½Ğµ Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ½'
            space = 'Â ' * (38 - len(parts[part][1]) - len(str(lvl)))
            description = '**{0}**{2}***{1}* ğ“µğ“¿ğ“µ**'.format(parts[part][1], lvl, space)
            fields = self.generateText(main = main, subs = [sub1, sub2, sub3, sub4])


            embed = createEmbed(title = title, description = description, authorName = authorName, authorIconURL = authorIconURL, thumbnail = thumbnail, fields = fields)

            emojiAccept = self.client.get_emoji(874767321007276143)
            emojiExit = self.client.get_emoji(874767320915005471)
            btnAccept = Button(style=ButtonStyle.green, emoji = emojiAccept, id = 'accept')
            btnExit = Button(style=ButtonStyle.red, emoji = emojiExit, id = 'exit')

            components = self.getComponents("Ğ’Ñ‹Ğ±Ğ¾Ñ€ ÑĞµÑ‚Ğ°", sets.keys())
            components.append([btnAccept, btnExit])


            mes = await channel.send(embed = embed, components = components)


            def check(res):
                return res.channel == channel and res.author == message.author and res.message.id == mes.id

            #while True:

            # Ğ’Ñ‹Ğ±Ğ¾Ñ€ ÑĞµÑ‚Ğ°

            tasks = getTasks(self, check)

            while tasks:
                try:
                    done, pending = await asyncio.wait(tasks, return_when=asyncio.FIRST_COMPLETED)

                    for x in done:
                        res = x.result()
                        if res.custom_id == 'select':
                            title = res.component[0].label
                            thumbnail = sets[title][part]
                            fields = self.generateText(main = main, subs = [sub1, sub2, sub3, sub4])
                            embed = createEmbed(title = title, description = description, authorName = authorName, authorIconURL = authorIconURL, thumbnail = thumbnail, fields = fields)
                            await res.respond(type=7, embed = embed)

                        elif res.custom_id == 'accept':
                            if title != 'Ğ¡ĞµÑ‚ Ğ½Ğµ Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ½':
                                tasks = []
                                break
                            else:
                                await res.respond(content = 'Ğ¡ĞµÑ‚ Ğ½Ğµ Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ½!')
                        elif res.custom_id == 'exit':
                            raise Exception

                        tasks = getTasks(self, check)
#asyncio.exceptions.CancelledError

                except:
                    print('Exit')
                    components=[]
                    await mes.edit(components = components)
                    await mes.delete(delay = 10)
                    await message.delete(delay = 10)
                    return


            print('pass', res.custom_id)

            # Ğ¡ĞµÑ‚ Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ½ Ğ»ÑƒĞ¿ Ğ·Ğ°ĞºĞ¾Ğ½Ñ‡ĞµĞ½



            # Ğ’Ñ‹Ğ±Ğ¾Ñ€ Ğ¼ĞµĞ¹Ğ½ ÑÑ‚Ğ°Ñ‚Ğ° Ğ¸ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ñ†Ğ¸Ñ„ĞµÑ€Ğ¾Ğº

            if part == 'Ñ†Ğ²ĞµÑ‚Ğ¾Ğº': #Ğ½Ğ° 4 10 17 + 204 Ğ²Ğ¼ĞµÑÑ‚Ğ¾ 203
                main = ['HP', allStats['HP'][lvl]]
                subStat.remove('HP')

            elif part == 'Ğ¿ĞµÑ€Ğ¾':
                main = ['ATK', allStats['ATK'][lvl]]
                subStat.remove('ATK')

            else:
                components = self.getComponents("Ğ’Ñ‹Ğ±Ğ¾Ñ€ Ğ¼ĞµĞ¹Ğ½ ÑÑ‚Ğ°Ñ‚Ğ°", mainStat)
                components.append([btnAccept, btnExit])
                fields = self.generateText(main = main, subs = [sub1, sub2, sub3, sub4])
                embed = createEmbed(title = title, description = description, authorName = authorName, authorIconURL = authorIconURL, thumbnail = thumbnail, fields = fields)
                await res.respond(type=7, embed = embed, components = components)


                tasks = getTasks(self, check)

                while tasks:
                    try:
                        done, pending = await asyncio.wait(tasks, return_when=asyncio.FIRST_COMPLETED)

                        for x in done:
                            res = x.result()
                            if res.custom_id == 'select':
                                main = [res.component[0].label, 'â€”']
                                fields = self.generateText(main = main, subs = [sub1, sub2, sub3, sub4])
                                embed = createEmbed(title = title, description = description, authorName = authorName, authorIconURL = authorIconURL, thumbnail = thumbnail, fields = fields)
                                await res.respond(type=7, embed = embed)

                            elif res.custom_id == 'accept':
                                if main:
                                    tasks = []
                                    break
                                else:
                                    await res.respond(content = 'ĞœĞµĞ¹Ğ½ ÑÑ‚Ğ°Ñ‚ Ğ½Ğµ Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ½!')

                            elif res.custom_id == 'exit':
                                raise Exception

                            tasks = getTasks(self, check)



                    except:
                        print('Exit')
                        components=[]
                        await mes.edit(components = components)
                        await mes.delete(delay = 10)
                        await message.delete(delay = 10)
                        return


                # ĞœĞµĞ¹Ğ½ ÑÑ‚Ğ°Ñ‚ Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ½ Ğ¿ĞµÑ€ĞµÑ…Ğ¾Ğ´Ğ¸Ğ¼ Ğº Ğ·Ğ°Ğ¿Ğ¸ÑĞ¸ Ñ‡Ğ¸ÑĞ»Ğ°

                # Ğ’Ñ‹Ñ‡Ğ¸ÑĞ»ĞµĞ½Ğ¸Ğµ Ğ¼ĞµĞ¹Ğ½ ÑÑ‚Ğ°Ñ‚Ğ°
                if main[0] in subStat:
                    subStat.remove(main[0])

                if listCheckEntry(main[0], elements):
                    main[1] = allStats['elements'][lvl]
                else:
                    main[1] = allStats[main[0]][lvl]






            print('Main stat number selected, pass')
            # ĞœĞµĞ¹Ğ½ ÑÑ‚Ğ°Ñ‚ Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ½ Ğ¸ Ğ·Ğ°Ğ¿Ğ¸ÑĞ°Ğ½

            subs = {1: sub1, 2: sub2, 3: sub3, 4: sub4}
            percent = ['CRIT', '%', 'DMG', 'BONUS', 'ER']


            for i in range(1, 5):
                components = self.getComponents("Ğ’Ñ‹Ğ±Ğ¾Ñ€ {} ÑĞ°Ğ± ÑÑ‚Ğ°Ñ‚Ğ°".format(i), subStat)
                components.append([btnAccept, btnExit])
                fields = self.generateText(main = main, subs = [subs[1], subs[2], subs[3], subs[4]])
                embed = createEmbed(title = title, description = description, authorName = authorName, authorIconURL = authorIconURL, thumbnail = thumbnail, fields = fields)
                await res.respond(type=7, embed = embed, components = components)

                tasks = getTasks(self, check)

                while tasks:
                    try:
                        done, pending = await asyncio.wait(tasks, return_when=asyncio.FIRST_COMPLETED)

                        for x in done:
                            res = x.result()
                            if res.custom_id == 'select':
                                subs[i] = [res.component[0].label, 'â€”']
                                fields = self.generateText(main = main, subs = [subs[1], subs[2], subs[3], subs[4]])
                                embed = createEmbed(title = title, description = description, authorName = authorName, authorIconURL = authorIconURL, thumbnail = thumbnail, fields = fields)
                                await res.respond(type=7, embed = embed)


                            elif res.custom_id == 'accept':
                                if subs[i]:
                                    tasks = []
                                    break
                                else:
                                    await res.respond(content = 'Ğ¡Ğ°Ğ± ÑÑ‚Ğ°Ñ‚ {} Ğ½Ğµ Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ½!'.format(i))
                            elif res.custom_id == 'exit':
                                raise Exception

                            tasks = getTasks(self, check)


                    except:
                        print('Exit')
                        components=[]
                        await mes.edit(components = components)
                        await mes.delete(delay = 10)
                        await message.delete(delay = 10)
                        return


                print('Sub stat {} selected'.format(i))

                subStat.remove(subs[i][0])
                components = self.getButtons()
                fields = self.generateText(main = main, subs = [subs[1], subs[2], subs[3], subs[4]])
                embed = createEmbed(title = title, description = description, authorName = authorName, authorIconURL = authorIconURL, thumbnail = thumbnail, fields = fields)
                await res.respond(type=7, embed = embed, components = components)

                number = ''
                state = subs[i][0]
                zero = True
                dot = True
                while True:

                    try:
                        res = await self.client.wait_for("button_click", check = check, timeout = 60.0)

                    except:
                        components=[]
                        await mes.edit(components = components)
                        await mes.delete(delay = 10)
                        await message.delete(delay = 10)
                        return

                    else:

                        if res.component.id in ['1', '2', '3', '4', '5', '6', '7', '8', '9', '0', ]:
                            number += res.component.id
                            zero = False
                            if listCheckEntry(state, percent):
                                if '.' in number:
                                    dot = True
                                    zero = True
                                else:
                                    dot = False
                            else:

                                dot = True



                            components = self.getButtons(zero = zero, dot = dot)

                        elif res.component.id == '.':
                            number += res.component.id
                            zero = True
                            dot = True
                            components = self.getButtons(zero = zero, dot = dot)

                        elif res.component.id == 'clear':
                            number = number[:-1]
                            if number:
                                components = self.getButtons(zero = zero, dot = dot)
                            else:
                                zero = True
                                dot = True
                                components = self.getButtons(zero = zero, dot = dot)

                        elif res.component.id == 'clean entry':
                            number = ''
                            zero = True
                            dot = True
                            components = self.getButtons(zero = zero, dot = dot)

                        elif res.component.id == 'accept':
                            if number:
                                try:
                                    testNumber = float(number)
                                    if testNumber > allStats[state]['max']:
                                        await res.respond(content = 'Ğ¡Ğ°Ğ± ÑÑ‚Ğ°Ñ‚ {} Ğ¿Ñ€ĞµĞ²Ñ‹ÑˆĞ°ĞµÑ‚ Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ñ‹Ğ¹ ÑÑ‚Ğ°Ñ‚!'.format(i))
                                        continue
                                    if numDecimalPlaces(number) > 1 or ('.' in number and len(number.split('.')[1]) > 1):
                                        await res.respond(content = 'Ğ’ ÑĞ°Ğ± ÑÑ‚Ğ°Ñ‚Ğµ {} ÑĞ»Ğ¸ÑˆĞºĞ¾Ğ¼ Ğ¼Ğ½Ğ¾Ğ³Ğ¾ Ğ·Ğ½Ğ°ĞºĞ¾Ğ² Ğ¿Ğ¾ÑĞ»Ğµ Ñ‚Ğ¾Ñ‡ĞºĞ¸!'.format(i))
                                        continue

                                except ValueError:
                                    await res.respond(content = 'Ğ¡Ğ°Ğ± ÑÑ‚Ğ°Ñ‚ {} Ğ·Ğ°Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½ Ğ½ĞµĞ²ĞµÑ€Ğ½Ğ¾!'.format(i))
                                    continue
                                else:
                                    if listCheckEntry(state, percent):
                                        subs[i] = [state, float(number)]
                                    break
                            else:
                                await res.respond(content = 'Ğ¡Ğ°Ğ± ÑÑ‚Ğ°Ñ‚ {} Ğ½Ğµ Ğ·Ğ°Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½!'.format(i))
                                continue

                        elif res.component.id == 'exit':
                            components=[]
                            await mes.edit(components = components)
                            await mes.delete(delay = 10)
                            await message.delete(delay = 10)
                            return

                        subs[i] = [state, number]
                        fields = self.generateText(main = main, subs = [subs[1], subs[2], subs[3], subs[4]])
                        embed = createEmbed(title = title, description = description, authorName = authorName, authorIconURL = authorIconURL, thumbnail = thumbnail, fields = fields)
                        await res.respond(type=7, embed = embed, components = components)





            # Ğ£ÑĞ¿ĞµÑˆĞ½Ğ¾ ÑĞ¾Ğ·Ğ°Ğ´Ğ½Ğ½Ñ‹Ğ¹ Ğ°Ñ€Ñ‚ Ğ½Ğ°Ğ´Ğ¾ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ² Ğ±Ğ´
            request = f"INSERT INTO artifacts VALUES(DEFAULT, \'{title}\', \'{part}\', {lvl}, \'{main[0]}\', \'{main[1]}\'"

            for sub in [subs[1], subs[2], subs[3], subs[4]]:
                request += f", \'{sub[0]}\', \'{sub[1]}\'"

            request += ") RETURNING id;"
            respondRequest = self.db.command(request)
            footer = None
            authorName = 'ĞĞµ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ğ»Ğ¾ÑÑŒ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ°Ñ€Ñ‚ĞµÑ„Ğ°ĞºÑ‚('
            if respondRequest != 0:
                artifactsIDs = self.db.getValue(tableName = 'users_arts', argument = 'artifacts', selector = 'user_id', value = message.author.id)
                if artifactsIDs:
                    artifactsIDs = eval(artifactsIDs)
                    artifactsIDs.append(respondRequest[0][0])
                    respond = self.db.update(tableName = 'users_arts', argument = 'artifacts', selector = 'user_id', newValue = str(artifactsIDs), findValue = message.author.id)

                else:
                    artifactsIDs = [respondRequest[0][0]]
                    respond = self.db.insert('users_arts', message.author.id, str(artifactsIDs))

                if respond:
                    footer = ['ID ' + '0' * (5 - len(str(respondRequest[0][0]))) + str(respondRequest[0][0]),
                                'https://cdn.discordapp.com/attachments/813825744789569537/877565862935150662/view_watch_eye_icon_131255.png']
                    authorName = 'ĞÑ€Ñ‚ĞµÑ„Ğ°ĞºÑ‚ ÑƒÑĞµÑˆĞ½Ğ¾ ÑĞ¾Ğ·Ğ´Ğ°Ğ½ Ğ¸ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½'



            components=[]

            fields = self.generateText(main = main, subs = [subs[1], subs[2], subs[3], subs[4]])
            embed = createEmbed(title = title, description = description, authorName = authorName, authorIconURL = authorIconURL, thumbnail = thumbnail, fields = fields, footer = footer)
            await mes.edit(embed = embed, components = components)
            #await channel.send('Artifact successfully added~!')



        except Exception as e:
            printError()
            await mes.delete(delay = 10)
            await message.delete(delay = 10)



    def generateText(self, main = None, subs = [None, None, None, None]):

        result = []
        percent = ['CRIT', '%', 'DMG', 'BONUS', 'ER']

        if main:
            state = main.copy()
            state[1] = str(state[1])
            if listCheckEntry(state[0], percent):
                state[1] += '%'
            res = '`{0}{1}{2}{3}{4}`'.format(state[0], 'Â '*(13-len(state[0])), 'â€”', 'Â '*(13-len(state[1])), state[1])
        else:
            res = '`â€”{}â€”`'.format('Â '*25)
        result.append({'name': res, 'value': '_ _', 'inline': False})
        result.append({'name': 'â”â”â”â”â”â”â”â”â”â”â”â”â”“', 'value': '_ _', 'inline': False})

        for sub in subs:

            if sub:
                state = sub.copy()
                state[1] = str(state[1])
                if listCheckEntry(state[0], percent):
                    state[1] += '%'
                res = '`{0}{1}{2}{3}{4}`'.format(state[0], 'Â '*(13-len(state[0])), 'â€”', 'Â '*(13-len(state[1])), state[1])
            else:
                res = '`â€”{}â€”`'.format('Â '*25)
            result.append({'name': res, 'value': '_ _', 'inline': False})


        result.append({'name': 'â”—â”â”â”â”â”â”â”â”â”â”â”â”›', 'value': '_ _', 'inline': False})
        return result

    def getComponents(self, label, list):
        components=[
                    Select(
                        placeholder=label,
                        options=[SelectOption(label=item, value=item) for item in list],
                        custom_id="select",
                        ),
                    ]
        return components

    def getButtons(self, zero = True, dot = True):
        btn1 = Button(style=ButtonStyle.gray, label = '1', id = '1')
        btn2 = Button(style=ButtonStyle.gray, label = '2', id = '2')
        btn3 = Button(style=ButtonStyle.gray, label = '3', id = '3')
        btn4 = Button(style=ButtonStyle.gray, label = '4', id = '4')
        btn5 = Button(style=ButtonStyle.gray, label = '5', id = '5')
        btn6 = Button(style=ButtonStyle.gray, label = '6', id = '6')
        btn7 = Button(style=ButtonStyle.gray, label = '7', id = '7')
        btn8 = Button(style=ButtonStyle.gray, label = '8', id = '8')
        btn9 = Button(style=ButtonStyle.gray, label = '9', id = '9')
        btn0 = Button(style=ButtonStyle.gray, label = '0', id = '0', disabled = zero)
        btnDot = Button(style=ButtonStyle.gray, label = '.', id = '.', disabled = dot)

        btnInvisible = Button(style=ButtonStyle.gray, label = '-', disabled = True)


        emojiClear = self.client.get_emoji(873921151372513312)
        emojiAccept = self.client.get_emoji(874767321007276143)
        emojiCleanEntry = 'ğŸ”™'
        emojiExit = self.client.get_emoji(874767320915005471)


        btnClear = Button(style=ButtonStyle.gray, emoji = emojiClear, id = 'clear')
        btnAccept = Button(style=ButtonStyle.green, emoji = emojiAccept, id = 'accept')
        btnCleanEntry = Button(style=ButtonStyle.red, emoji = emojiCleanEntry, id = 'clean entry')
        btnExit = Button(style=ButtonStyle.red, emoji = emojiExit, id = 'exit')

        components=[[btn1, btn2, btn3, btnClear], [btn4, btn5, btn6, btnCleanEntry], [btn7, btn8, btn9, btnAccept], [btnInvisible, btn0, btnDot, btnExit], ]

        return components
